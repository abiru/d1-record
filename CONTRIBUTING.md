# 🤝 CONTRIBUTING.md — d1-record Contribution Guide

## 🎯 Purpose

`d1-record` is an OSS project aiming to become a **lightweight ActiveRecord-style ORM for Cloudflare D1 (TypeScript / Bun)**.
The project grows through collaboration between **Codex AI agents and human contributors**.
This guide summarizes the rules, workflow, and best practices for contributing.

---

## 🧠 Development model

The project is driven by three roles:

| Role                  | Responsibilities                                                     |
| --------------------- | ------------------------------------------------------------------- |
| 🧠 **Codex Agent**      | Reads issues, generates code/tests/docs automatically, and opens PRs |
| 👤 **Human Maintainer** | Reviews PRs, makes architectural decisions, manages npm releases     |
| 🤖 **CI Agent**         | Runs lint, tests, and release automation                             |

Humans and AI work together to maintain a safe, fast development cycle.

---

## 🪜 Development flow

### 1️⃣ Create an issue

* Every task starts with a **GitHub Issue**.
* When requesting Codex, use `.github/ISSUE_TEMPLATE/feature_codex.yml`.
* Keep each issue focused on a single goal (e.g., “Add where() to BaseModel”).

### 2️⃣ Codex opens a PR

* Codex interprets the issue and opens a PR from a `feature/issue-xxx` branch.
* Every PR must include:

  * Implementation code
  * Tests that pass with `bun test`
  * Documentation updates (`README.md`, `CHANGELOG.md`)

### 3️⃣ CI checks

* GitHub Actions automatically runs:

  * `bun lint`
  * `bun test`
* PRs that fail CI are automatically rejected.

### 4️⃣ Review and merge

* A human maintainer reviews the changes.
* Approved PRs are manually merged into `main`.
* Merging triggers npm publishing via `release.yml`.

---

## 📜 Coding standards

### ✅ Language and syntax

* TypeScript with ESM syntax
* Target the Bun runtime (avoid Node-specific APIs)
* Keep `strict: true` for type safety

### ✅ Formatting

* Linter: ESLint
* Formatter: Prettier
* Fix all lint errors before opening a PR

### ✅ Testing

* Test runner: Bun (`bun test`)
* Do not connect to external databases—use MockDB
* Express intent clearly with `describe()` / `it()` blocks

### ✅ Commit messages

Follow [Conventional Commits](https://www.conventionalcommits.org/):

Examples:

* feat: add where() query helper
* fix: correct update() SQL bind order
* chore: update dependencies
* test: add coverage for delete()
* docs: improve README examples

---

## 🧩 Documentation

* API docs are generated automatically via `typedoc`.
* Update `README.md` and `CHANGELOG.md` with every code change.
* Add usage examples whenever you introduce a new public API.

---

## 🧱 Branch strategy

| Branch name        | Purpose                                      |
| ------------------ | -------------------------------------------- |
| `main`             | Stable releases (CI passes, npm publishes)    |
| `feature/issue-xxx`| Working branches generated by Codex           |
| `docs/*`           | Documentation updates                         |
| `test/*`           | Testing improvements                          |

---

## 🧰 Development environment

Install dependencies:

```
bun install
```

Run tests:

```
bun test
```

Run lint:

```
bun lint
```

Generate docs (optional):

```
bun run typedoc
```

---

## 🧑‍💻 For human contributors

When updating code directly:

* Follow the same rules as Codex (type safety, linting, tests)
* Explain context, motivation, and verification steps in your PR
* Include tests even for small fixes

---

## 🤖 Notes for Codex agents

Codex must:

* Submit code that passes `bun test`
* Update `README.md` and `CHANGELOG.md`
* Use `prepare().bind()` for all SQL statements
* Avoid adding external dependencies (stick to standard APIs)
* Prioritize readability and maintainability

---

## 💬 Communication

* Share proposals or questions in [Discussions](https://github.com/ledkikaku/d1-record/discussions).
* Report bugs via the Issues tab.
* Keep PR reviews transparent and open.

---

## ❤️ Appreciation

This project reimagines the **elegance of Heroku** combined with the **lightweight power of Cloudflare**.
Your contributions make web development simpler and more beautiful.

**Thank you for helping build `d1-record`!**
